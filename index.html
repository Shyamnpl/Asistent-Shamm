<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Vision Assistant - Debug Mode</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            width: 100vw;
            position: relative;
            overflow-x: hidden;
        }
        
        .glassmorphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        
        .debug-console {
            background: rgba(0, 0, 0, 0.8);
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body class="flex flex-col items-center min-h-screen text-white p-4 py-8">
    
    <div class="w-full max-w-2xl flex flex-col z-10 space-y-4">
        <!-- Debug Header -->
        <div class="glassmorphism p-4">
            <h1 class="text-xl font-bold text-center">üîß Gemini API Debug Mode</h1>
            <p class="text-center text-sm opacity-80 mt-2">Testing API connection with detailed error reporting</p>
        </div>

        <!-- API Test Section -->
        <div class="glassmorphism p-4">
            <h2 class="text-lg font-bold mb-3">üß™ Test Gemini API</h2>
            
            <div class="space-y-3">
                <button onclick="testGeminiConnection()" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg transition duration-200">
                    üöÄ Test API Connection
                </button>
                
                <button onclick="testWithSimplePrompt()" class="w-full bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg transition duration-200">
                    üí¨ Test with Simple Prompt
                </button>

                <button onclick="checkAPIKey()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-2 px-4 rounded-lg transition duration-200">
                    üîë Validate API Key
                </button>
            </div>
        </div>

        <!-- Debug Console -->
        <div class="glassmorphism p-4">
            <h2 class="text-lg font-bold mb-3">üìü Debug Console</h2>
            <div id="debugConsole" class="debug-console p-3 rounded-lg h-48">
                <div>> System initialized. Click buttons above to test API.</div>
            </div>
        </div>

        <!-- API Configuration -->
        <div class="glassmorphism p-4">
            <h2 class="text-lg font-bold mb-3">‚öôÔ∏è API Configuration</h2>
            <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                    <span>API Key:</span>
                    <span id="apiKeyStatus" class="px-2 py-1 rounded bg-red-500">Not Tested</span>
                </div>
                <div class="flex justify-between">
                    <span>Model:</span>
                    <span>gemini-1.5-pro</span>
                </div>
                <div class="flex justify-between">
                    <span>Endpoint:</span>
                    <span class="text-xs">generativelanguage.googleapis.com</span>
                </div>
            </div>
        </div>

        <!-- Common Solutions -->
        <div class="glassmorphism p-4">
            <h2 class="text-lg font-bold mb-3">üîß Common Solutions</h2>
            <div class="space-y-2 text-sm">
                <div class="flex items-start space-x-2">
                    <span class="text-red-400">‚Ä¢</span>
                    <span>Check if API key has proper permissions for Gemini</span>
                </div>
                <div class="flex items-start space-x-2">
                    <span class="text-red-400">‚Ä¢</span>
                    <span>Verify API key is correct and not expired</span>
                </div>
                <div class="flex items-start space-x-2">
                    <span class="text-red-400">‚Ä¢</span>
                    <span>Ensure Gemini API is enabled in Google Cloud Console</span>
                </div>
                <div class="flex items-start space-x-2">
                    <span class="text-red-400">‚Ä¢</span>
                    <span>Check if there are usage quotas or billing issues</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const GEMINI_API_KEY = "AIzaSyCAeedrWW42idbmY_6ad7YnWRe9dMgvPDY";
        const GEMINI_MODEL = "gemini-1.5-pro";
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${GEMINI_API_KEY}`;

        // Debug console functions
        function logToConsole(message, type = 'info') {
            const console = document.getElementById('debugConsole');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'red' : type === 'success' ? '#00ff00' : 'cyan';
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: gray">[${timestamp}]</span> <span style="color: ${color}">${message}</span>`;
            console.appendChild(logEntry);
            console.scrollTop = console.scrollHeight;
        }

        // Test API Connection
        async function testGeminiConnection() {
            logToConsole('Testing Gemini API connection...', 'info');
            
            try {
                const response = await fetch(GEMINI_API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: "Hello, please respond with 'API is working' if you can read this."
                            }]
                        }]
                    })
                });

                logToConsole(`HTTP Status: ${response.status} ${response.statusText}`, 'info');

                if (!response.ok) {
                    const errorText = await response.text();
                    logToConsole(`Error Response: ${errorText}`, 'error');
                    
                    // Try to parse as JSON for better error message
                    try {
                        const errorJson = JSON.parse(errorText);
                        logToConsole(`Parsed Error: ${JSON.stringify(errorJson, null, 2)}`, 'error');
                    } catch (e) {
                        logToConsole(`Raw Error: ${errorText}`, 'error');
                    }
                    
                    document.getElementById('apiKeyStatus').className = 'px-2 py-1 rounded bg-red-500';
                    document.getElementById('apiKeyStatus').textContent = 'Failed';
                    return;
                }

                const result = await response.json();
                logToConsole(`Success! API Response: ${JSON.stringify(result, null, 2)}`, 'success');
                
                document.getElementById('apiKeyStatus').className = 'px-2 py-1 rounded bg-green-500';
                document.getElementById('apiKeyStatus').textContent = 'Working';

            } catch (error) {
                logToConsole(`Network Error: ${error.message}`, 'error');
                logToConsole(`Full Error: ${error}`, 'error');
                
                document.getElementById('apiKeyStatus').className = 'px-2 py-1 rounded bg-red-500';
                document.getElementById('apiKeyStatus').textContent = 'Network Error';
            }
        }

        // Test with simple prompt
        async function testWithSimplePrompt() {
            logToConsole('Testing with simple conversation...', 'info');
            
            try {
                const response = await fetch(GEMINI_API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: "What is 2+2? Answer in one word."
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.1,
                            maxOutputTokens: 10,
                        }
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    logToConsole(`Simple test failed: ${errorText}`, 'error');
                    return;
                }

                const result = await response.json();
                const answer = result.candidates[0].content.parts[0].text;
                logToConsole(`Simple test passed! Answer: "${answer}"`, 'success');

            } catch (error) {
                logToConsole(`Simple test error: ${error.message}`, 'error');
            }
        }

        // Check API Key format and basic validation
        function checkAPIKey() {
            logToConsole('Validating API key format...', 'info');
            
            const apiKey = GEMINI_API_KEY;
            
            // Basic validation checks
            if (!apiKey) {
                logToConsole('‚ùå API Key is empty', 'error');
                return;
            }
            
            if (apiKey.length !== 39) {
                logToConsole(`‚ùå API Key length is ${apiKey.length}, expected 39`, 'error');
            } else {
                logToConsole('‚úÖ API Key length is correct (39 characters)', 'success');
            }
            
            if (apiKey.startsWith('AIza')) {
                logToConsole('‚úÖ API Key starts with correct prefix (AIza)', 'success');
            } else {
                logToConsole('‚ùå API Key does not start with AIza', 'error');
            }
            
            logToConsole(`API Key (first 10 chars): ${apiKey.substring(0, 10)}...`, 'info');
        }

        // Test different API endpoints
        async function testAlternativeEndpoints() {
            logToConsole('Testing alternative API endpoints...', 'info');
            
            const endpoints = [
                'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent',
                'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent',
                'https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent'
            ];
            
            for (const endpoint of endpoints) {
                const testUrl = `${endpoint}?key=${GEMINI_API_KEY}`;
                logToConsole(`Testing: ${endpoint}`, 'info');
                
                try {
                    const response = await fetch(testUrl, {
                        method: "POST",
                        headers: {"Content-Type": "application/json"},
                        body: JSON.stringify({contents: [{parts: [{text: "test"}]}]})
                    });
                    
                    logToConsole(`Endpoint ${endpoint}: ${response.status}`, response.ok ? 'success' : 'error');
                } catch (error) {
                    logToConsole(`Endpoint ${endpoint}: ${error.message}`, 'error');
                }
            }
        }

        // Initialize
        window.addEventListener('load', () => {
            logToConsole('Debug console ready. Click "Test API Connection" to diagnose issues.', 'info');
            checkAPIKey();
        });

        // Add test buttons to the page
        document.addEventListener('DOMContentLoaded', function() {
            const solutionsDiv = document.querySelector('.glassmorphism:last-child');
            const testButton = document.createElement('button');
            testButton.innerHTML = 'üåê Test Alternative Endpoints';
            testButton.className = 'w-full bg-purple-500 hover:bg-purple-600 text-white py-2 px-4 rounded-lg transition duration-200 mt-3';
            testButton.onclick = testAlternativeEndpoints;
            solutionsDiv.appendChild(testButton);
        });
    </script>
</body>
</html>
